name: ðŸ“ Submit New Project Guide

on:
  workflow_dispatch:
    inputs:
      category:
        description: 'Project category (folder name)'
        required: true
        type: choice
        options:
          - Getting Started
          - Educational
          - Games
      project_name:
        description: 'Project name (will be used for URL slug)'
        required: true
        type: string
      markdown_content:
        description: 'Paste your markdown content here'
        required: true
        type: string

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create new branch
        run: |
          BRANCH_NAME="project-submission-$(date +%s)"
          git checkout -b "$BRANCH_NAME"
          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

      - name: Create project file
        run: |
          # Sanitize filename
          FILENAME=$(echo "${{ inputs.project_name }}" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9-]/-/g' | sed 's/--*/-/g' | sed 's/^-//' | sed 's/-$//')
          FILEPATH="projects/${{ inputs.category }}/${FILENAME}.md"

          # Create directory if it doesn't exist
          mkdir -p "projects/${{ inputs.category }}"

          # Write content to file
          cat > "$FILEPATH" << 'EOF'
          ${{ inputs.markdown_content }}
          EOF

          echo "FILEPATH=$FILEPATH" >> $GITHUB_ENV
          echo "FILENAME=$FILENAME" >> $GITHUB_ENV

      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Add new project: ${{ inputs.project_name }}"
          git push origin "$BRANCH_NAME"

      - name: Create Pull Request
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh pr create \
            --title "New Project Submission: ${{ inputs.project_name }}" \
            --body "**Category:** ${{ inputs.category }}
          **Submitted by:** @${{ github.actor }}

          This PR adds a new project to the site. Please review the content for quality and appropriateness before merging." \
            --base main \
            --head "$BRANCH_NAME"
